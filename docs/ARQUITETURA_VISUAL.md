# ğŸ—ï¸ ARQUITETURA E FLUXO DE DADOS

## Diagrama da Infraestrutura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      INTERNET / USUARIOS                         â”‚
â”‚                   (Acessam via browser)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    https://seu-dominio.com:443
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     LINUX SERVER (Ubuntu/Debian)                â”‚
â”‚                     IP: 123.45.67.89                            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               DOCKER (Container Runtime)                 â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  CONTAINER 1: FRONTEND (Nginx)                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Image: nginx:alpine                         â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Port: 80 â†’ 80 (HTTP)                        â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Port: 443 â†’ 443 (HTTPS)                     â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                             â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ /usr/share/nginx/html:                      â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ index.html                            â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ assets/ (JS/CSS/imagens)              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€ (React compilado - Vite)             â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                             â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Proxy: /api/* â†’ http://backend:3001        â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Headers: X-Frame-Options, X-Content-Type   â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Cache: 1 ano para assets, 0 para HTML      â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ CompressÃ£o: Gzip + Brotli                  â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                           â”‚                             â”‚  â”‚
â”‚  â”‚                   /api/* (proxy)                        â”‚  â”‚
â”‚  â”‚                           â”‚                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  CONTAINER 2: BACKEND (Node.js)                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Image: node:20-alpine                        â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Port: 3001 (apenas internamente)             â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ /app:                                        â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ src/server.js (Express)               â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ src/routes/                            â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ src/controllers/                       â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ src/models/ (Sequelize)               â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€ node_modules/ (npm packages)          â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ /app/uploads:                               â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€ nfs/ (relatÃ³rios, PDFs)              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ ENV vars (from .env):                        â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   - DATABASE_URL                            â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   - JWT_SECRET                              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   - ALLOWED_ORIGINS                         â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   - FRONTEND_URL                            â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Middlewares:                                 â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   âœ“ Helmet (10+ security headers)           â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   âœ“ CORS (dinÃ¢mico)                         â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   âœ“ JWT Auth                                â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   âœ“ Joi Validation                          â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   âœ“ Global Error Handler                    â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                       â”‚                               â”‚  â”‚
â”‚  â”‚              SQL queries (port 5432)                  â”‚  â”‚
â”‚  â”‚                       â”‚                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  CONTAINER 3: POSTGRESQL (Database)             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Image: postgres:16-alpine                    â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Port: 5432 (apenas internamente)             â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Database: edda_db                            â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ User: edda_user                              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Volume: postgres_data                        â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€ /var/lib/postgresql/data               â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚       (persistido mesmo apÃ³s stop)           â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Tabelas:                                     â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ Users (autenticaÃ§Ã£o)                  â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ Clientes (CNPJ)                       â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ Relatorios (reports)                  â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ Pecas (parts)                         â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ Servicos (services)                   â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€ ... (outras)                          â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                              â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Backups: (volume postgres_data)             â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚   Docker: docker-compose exec postgres \    â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚           pg_dump -U edda_user -d edda_db   â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  DOCKER NETWORK: edda_network (bridge)             â”‚  â”‚
â”‚  â”‚    â””â”€ frontend â†” backend â†” postgres                â”‚  â”‚
â”‚  â”‚       (comunicaÃ§Ã£o interna)                         â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  VOLUMES (PersistÃªncia):                            â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ postgres_data (dados do DB)                 â”‚  â”‚
â”‚  â”‚    â””â”€â”€ backend_uploads (arquivos gerados)          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  Firewall (UFW):                                           â”‚
â”‚    ALLOW: 22 (SSH)                                         â”‚
â”‚    ALLOW: 80 (HTTP)                                        â”‚
â”‚    ALLOW: 443 (HTTPS)                                      â”‚
â”‚    DENY: others                                            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Fluxo de uma RequisiÃ§Ã£o (HTTP)

### 1. RequisiÃ§Ã£o GET /api/clientes

```
BROWSER                 NGINX                  BACKEND               POSTGRES
  â”‚                       â”‚                      â”‚                      â”‚
  â”‚â”€ GET /api/clients â”€â”€â–¶ â”‚                      â”‚                      â”‚
  â”‚                       â”‚â”€ proxy_pass â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚                      â”‚
  â”‚                       â”‚   (3001)              â”‚                      â”‚
  â”‚                       â”‚                      â”‚â”€ SELECT * FROM      â”‚
  â”‚                       â”‚                      â”‚   Clientes â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚
  â”‚                       â”‚                      â”‚                      â”‚
  â”‚                       â”‚                      â”‚                 [Query]
  â”‚                       â”‚                      â”‚ â—€â”€ [rows] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”‚                       â”‚                      â”‚                      â”‚
  â”‚                       â”‚â—€â”€ JSON response â”€â”€â”€â”€â”€â”‚                      â”‚
  â”‚                       â”‚                      â”‚                      â”‚
  â”‚â—€â”€ 200 + JSON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                      â”‚
  â”‚ (+ security headers)  â”‚                      â”‚                      â”‚
```

### 2. RequisiÃ§Ã£o POST /api/clientes (criar novo)

```
BROWSER              NGINX              BACKEND                 POSTGRES
  â”‚                    â”‚                   â”‚                       â”‚
  â”‚â”€ POST + JSON â”€â”€â”€â”€â–¶ â”‚                   â”‚                       â”‚
  â”‚  (CNPJ, email)     â”‚â”€ proxy_pass â”€â”€â”€â”€â–¶ â”‚                       â”‚
  â”‚                    â”‚  (3001)           â”‚                       â”‚
  â”‚                    â”‚                  â”‚â”€ ValidaÃ§Ã£o             â”‚
  â”‚                    â”‚                  â”‚  âœ“ CNPJ check          â”‚
  â”‚                    â”‚                  â”‚  âœ“ Email check         â”‚
  â”‚                    â”‚                  â”‚  âœ“ Helmet headers      â”‚
  â”‚                    â”‚                  â”‚  âœ“ JWT auth            â”‚
  â”‚                    â”‚                  â”‚  âœ“ Role check          â”‚
  â”‚                    â”‚                  â”‚                       â”‚
  â”‚                    â”‚                  â”‚â”€ INSERT INTO Clientesâ”‚
  â”‚                    â”‚                  â”‚  (cnpj, email, ...) â–¶â”‚
  â”‚                    â”‚                  â”‚                       â”‚
  â”‚                    â”‚                  â”‚              [SQL ok]  â”‚
  â”‚                    â”‚                  â”‚ â—€â”€ ID: 123 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                    â”‚â—€â”€ 201 + {id:123} â”‚                       â”‚
  â”‚â—€â”€ 201 Created â”€â”€â”€â”€â”€â”‚                  â”‚                       â”‚
  â”‚  (+ headers)       â”‚                  â”‚                       â”‚
```

### 3. RequisiÃ§Ã£o com CORS (browser)

```
BROWSER              NGINX              BACKEND
  â”‚                    â”‚                   â”‚
  â”‚ OPTIONS /api/clientes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚
  â”‚  Origin: https://seu-dominio.com     â”‚
  â”‚                    â”‚                   â”‚
  â”‚                    â”‚ (ValidaÃ§Ã£o CORS)  â”‚
  â”‚                    â”‚ (ALLOWED_ORIGINS) â”‚
  â”‚                    â”‚                   â”‚
  â”‚â—€â”€ 204 No Content   â”‚                   â”‚
  â”‚   + Allow headers  â”‚                   â”‚
  â”‚   + Access-Control- â”‚                   â”‚
  â”‚     Allow-Origin    â”‚                   â”‚
  â”‚                    â”‚                   â”‚
  â”‚â”€ GET /api/clients â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
```

---

## Fluxo de Deployment (CI/CD)

```
LOCAL MACHINE          GITHUB              LINUX SERVER           DOCKER REGISTRY
     â”‚                    â”‚                     â”‚                      â”‚
  1. git commit â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚                     â”‚                      â”‚
  2. git push            â”‚                     â”‚                      â”‚
     â”‚                   â”‚                     â”‚                      â”‚
  3. (manual ou          â”‚                     â”‚                      â”‚
     webhook)            â”‚â”€ webhook â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚                      â”‚
                         â”‚                   â”‚                       â”‚
                         â”‚                   â”‚ git pull â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
                         â”‚                   â”‚                       â”‚
                         â”‚                   â”‚ docker build â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
                         â”‚                   â”‚ (FROM node:20-alpine) â”‚
                         â”‚                   â”‚                      â”‚
                         â”‚                   â”‚ npm ci (prod) â”€â”€â”€â”€â”€â”€â–¶â”‚
                         â”‚                   â”‚                      â”‚
                         â”‚                   â”‚ docker push â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
                         â”‚                   â”‚ (se usar registry)   â”‚
                         â”‚                   â”‚                      â”‚
                         â”‚                   â”‚ docker-compose      â”‚
                         â”‚                   â”‚   build             â”‚
                         â”‚                   â”‚   down              â”‚
                         â”‚                   â”‚   up -d             â”‚
                         â”‚                   â”‚                      â”‚
                         â”‚                   â”‚ âœ“ Sistema online!   â”‚
                         â”‚                   â”‚                      â”‚
```

---

## VariÃ¡veis de Ambiente e Suas FunÃ§Ãµes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VARIÃVEL       â”‚    USADO POR      â”‚   EFEITO          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DATABASE_URL     â”‚ Backend (Node)    â”‚ Conecta ao DB     â”‚
â”‚ JWT_SECRET       â”‚ Backend (Node)    â”‚ Assina tokens JWT â”‚
â”‚ ALLOWED_ORIGINS  â”‚ Backend (Express) â”‚ Valida CORS       â”‚
â”‚ FRONTEND_URL     â”‚ Backend (Email)   â”‚ Link reset senha  â”‚
â”‚ SERVER_BASE_URL  â”‚ Backend (Config)  â”‚ API base URL      â”‚
â”‚ EMAIL_USER       â”‚ Backend (Mail)    â”‚ Envia emails      â”‚
â”‚ EMAIL_APP_PASS   â”‚ Backend (Mail)    â”‚ Autentica email   â”‚
â”‚ DEBUG_MODE       â”‚ Backend (Logs)    â”‚ Verbosidade logs  â”‚
â”‚ NODE_ENV         â”‚ Backend (Config)  â”‚ Modo produÃ§Ã£o     â”‚
â”‚ DB_NAME          â”‚ Postgres (init)   â”‚ Nome do banco     â”‚
â”‚ DB_USER          â”‚ Postgres (init)   â”‚ UsuÃ¡rio DB        â”‚
â”‚ DB_PASSWORD      â”‚ Postgres (init)   â”‚ Senha DB          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ciclo de Vida dos Containers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          docker-compose up -d                â”‚
â”‚   (Iniciar containers em modo background)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                       â”‚
           â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   POSTGRES     â”‚    â”‚   BACKEND      â”‚
    â”‚                â”‚    â”‚                â”‚
    â”‚ 1. Pull image  â”‚    â”‚ 1. Pull image  â”‚
    â”‚ 2. Create vol  â”‚    â”‚ 2. Create vol  â”‚
    â”‚ 3. Run init    â”‚    â”‚ 3. Copy code   â”‚
    â”‚ 4. Health chk  â”‚    â”‚ 4. Health chk  â”‚
    â”‚ 5. Ready âœ“     â”‚    â”‚ 5. Ready âœ“     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     FRONTEND         â”‚
              â”‚                      â”‚
              â”‚ 1. Pull image        â”‚
              â”‚ 2. npm run build     â”‚
              â”‚ 3. Copy dist         â”‚
              â”‚ 4. Start nginx       â”‚
              â”‚ 5. Proxy to backend  â”‚
              â”‚ 6. Ready âœ“           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   ALL RUNNING âœ“        â”‚
          â”‚                        â”‚
          â”‚ $ docker-compose ps    â”‚
          â”‚                        â”‚
          â”‚ edda_postgres    Up    â”‚
          â”‚ edda_backend     Up    â”‚
          â”‚ edda_frontend    Up    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Mapeamento de Portas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MAPEAMENTO DE PORTAS                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ServiÃ§o  â”‚ Porta    â”‚ Exposto? â”‚ Acesso          â”‚
â”‚          â”‚ Containerâ”‚          â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Frontend â”‚ 80 â†’     â”‚ SIM      â”‚ :80 (HTTP)      â”‚
â”‚ (Nginx)  â”‚ 80       â”‚          â”‚ http://localhostâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Backend  â”‚ 3001 â†’   â”‚ NÃƒO      â”‚ :3001 interno   â”‚
â”‚ (Node)   â”‚ 3001     â”‚          â”‚ (nginx proxy)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Postgres â”‚ 5432 â†’   â”‚ NÃƒO      â”‚ :5432 interno   â”‚
â”‚ (DB)     â”‚ 5432     â”‚          â”‚ (backend access)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

* "Exposto" = acessÃ­vel de fora do servidor
* Backend e Postgres sÃ³ acessÃ­veis via NGINX (proxy)
  ou dentro da rede Docker (edda_network)
```

---

## SeguranÃ§a em Camadas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            INTERNET (Mundo externo)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                     â”‚
          â–¼ Firewall (UFW)      â–¼
     [PORTA 80]            [PORTA 443]
          â”‚                     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   NGINX      â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ - Headers    â”‚
              â”‚ - CORS check â”‚
              â”‚ - X-Frame    â”‚
              â”‚ - Rate limit â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚               â”‚               â”‚
     â–¼ /api (proxy)  â–¼ /static       â–¼ /
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND â”‚    â”‚ CACHE   â”‚    â”‚ INDEX.  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚         â”‚    â”‚ HTML    â”‚
â”‚ - Auth   â”‚    â”‚ (1 year)â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - JWT    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - Helmet â”‚
â”‚ - Role   â”‚
â”‚ - Joi    â”‚
â”‚ - Global â”‚
â”‚   Error  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   POSTGRESQL     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Only from      â”‚
â”‚   backend        â”‚
â”‚ - Encrypted pass â”‚
â”‚ - SSL mode       â”‚
â”‚ - Backup volume  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layers:
1. Firewall (OS)
2. NGINX (reverse proxy + headers)
3. Backend validation (JWT, roles, Joi)
4. Database access (authenticated)
```

---

## Plano de RecuperaÃ§Ã£o de Desastres

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        FALHA DETECTADA              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚           â”‚           â”‚
       â–¼           â–¼           â–¼
    Container   Service    Database
    Crash       Error      Down
       â”‚           â”‚           â”‚
       â”‚           â”‚           â”‚
       â–¼           â–¼           â–¼
    Restart    Restart     Restore
    (auto)     (manual)    from backup
       â”‚           â”‚           â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ HEALTH CHECKâ”‚
        â”‚  (Pass?)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
          â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
          â”‚          â”‚
          â–¼ NO       â–¼ YES
        Retry    âœ“ Online
```

---

Este documento serve como referÃªncia visual para entender como tudo se conecta! ğŸ¯
